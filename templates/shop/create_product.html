{% extends 'base.html' %}

{% block content %}
{% load static %}
<form method="post" enctype="multipart/form-data" id="product-form">
    {% csrf_token %}
    {{ form.as_p }}
    <div id="image-formset">
        {{ formset.management_form }}
        {% for form in formset %}
            <div class="image-form">
                {{ form.as_p }}
            </div>
        {% endfor %}
    </div>

    <button type="button" id="add-image-btn">Додати ще фото</button>
    <button type="submit">Зберегти продукт</button>
</form>3

<script >
    
document.addEventListener("DOMContentLoaded", function () {
    const addBtn = document.getElementById("add-image-btn");
    const formsetContainer = document.getElementById("image-formset");

    addBtn.addEventListener("click", function () {
        const totalForms = document.getElementById("id_images-TOTAL_FORMS");
        const formCount = parseInt(totalForms.value);
        const newForm = formsetContainer.querySelector(".image-form").cloneNode(true);

        // Оновлення індексів
        newForm.innerHTML = newForm.innerHTML.replaceAll(`-${formCount - 1}-`, `-${formCount}-`);
        const inputs = newForm.querySelectorAll('input');
        inputs.forEach(input => {
            input.value = '';  // очистити поля
        });

        formsetContainer.appendChild(newForm);
        totalForms.value = formCount + 1;
    });
});
</script>

{% endblock %}